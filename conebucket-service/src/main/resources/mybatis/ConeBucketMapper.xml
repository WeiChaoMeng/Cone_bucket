<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jiaoke.web.dao.ConeBucketMapper">

    <resultMap id="coneBucketMap" type="com.jiaoke.bean.ConeBucket">
        <result column="id" property="id"/>

        <!--关联查询线路信息表-->
        <collection property="roadInfo" ofType="com.jiaoke.bean.RoadInfo" column="id"
                    select="com.jiaoke.web.dao.RoadInfoMapper.selectRoadIdById"/>
    </resultMap>

    <select id="selectByProId" parameterType="java.lang.Integer" resultMap="coneBucketMap">
        SELECT
            cb.id,
            cb.last_location as lastLocation,
            cb.cone_bucket_type_id as coneBucketTypeId,
            cpt.type_name AS coneBucketTypeStr
        FROM
            `cone_bucket` AS cb
            LEFT JOIN project_cone_bucket AS pcb ON cb.id = pcb.cone_bucket_id
            LEFT JOIN cone_bucket_type AS cpt ON cb.cone_bucket_type_id = cpt.id
        WHERE
            pcb.pro_id = #{proId}
    </select>

    <select id="locationById" resultType="com.jiaoke.bean.ConeBucket">
        select last_location as lastLocation
        FROM
            `cone_bucket`
        where id = #{id}
    </select>

    <select id="allConeBucketPosition" resultMap="coneBucketMap">
        select
          id,
          last_location as lastLocation
        FROM
            `cone_bucket`
    </select>

</mapper>